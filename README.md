#   Лабораторная работы №4 по дисциплине "Системы копьютерного зрения"
# Обучение модели для классификация изображений

**Задача:** Разработка системы классификации изображений для различения двух классов объектов (в данной работе - чихуахуа и маффинов) с применением современных методов компьютерного зрения.  

### Цель работы  
&ensp; Создать end-to-end решение для классификации изображений на два класса, используя предобученную модель, аугментации данных и методы обработки bounding box'ов. Работа включает подготовку датасета, обучение модели, оценку качества и визуализацию результатов.  

### Задания:  
1. **Подготовка данных** — автоматическая загрузка датасета с Kaggle, фильтрация некорректных изображений, генерация аннотаций в формате YOLO.  
2. **Аугментация данных** — применение геометрических трансформаций, изменения яркости и размытия для увеличения разнообразия тренировочных данных.  
3. **Обучение модели** — дообучение YOLOv8 на подготовленном датасете с настройкой гиперпараметров.  
4. **Оценка качества** — расчет метрик (mAP, Precision, Recall, ROC AUC) и визуализация результатов (ROC-кривая, матрица ошибок).  
5. **Интерпретация результатов** — объединение пересекающихся bounding box'ов и детализированный вывод данных о распознанных объектах.  

---

### Описание работы   

---

### Подготовка данных  
Для работы используется датасет `muffin-vs-chihuahua`, загружаемый через функцию `setup_kaggle_dataset()`. Эта функция автоматически скачивает данные с платформы Kaggle, проверяет их целостность и организует в структуру с тренировочными и тестовыми поддиректориями для каждого класса. Если данные уже существуют, функция позволяет перезаписать их с помощью флага `force_copy`.  

**Генерация аннотаций** выполняется в два этапа:  
1. **Выделение крупных объектов** — функция `find_largest_object()` анализирует изображение с помощью гауссова размытия, адаптивной бинаризации и морфологических операций для выделения доминирующего объекта. Результатом является bounding box в формате YOLO (нормированные координаты центра, ширина и высота).  
2. **Фильтрация bounding box'ов** — функция `filter_bboxes()` оставляет только самый большой объект, игнорируя мелкие артефакты. Это обеспечивает чистоту аннотаций и повышает точность обучения.  

---

### Аугментация данных  
Для увеличения разнообразия тренировочных данных применяется пайплайн аугментаций, создаваемый функцией `create_augmentation_pipeline()`. Он включает горизонтальные и вертикальные отражения (с вероятностью 40% и 30%), случайные повороты (±20°), изменение яркости/контраста, размытие и масштабирование. Для каждого изображения генерируется 4 аугментированные копии, что увеличивает размер тренировочной выборки и снижает риск переобучения.  

---

### Обучение модели  
Модель YOLOv12 дообучается на подготовленном датасете с использованием конфигурации:  
- Размер входного изображения: 640x640,  
- Размер батча: 64,  
- Количество эпох: 20.  
Обучение проводится как на оригинальных, так и на аугментированных данных. Результаты сохраняются в отдельную директорию, включая веса модели и логи обучения.  

---

### Оценка качества  
Качество модели оценивается с помощью функции `evaluate_model()`, которая рассчитывает метрики:  
- **mAP@0.5 и mAP@0.5:0.95** — средняя точность при разных порогах Intersection over Union (IoU),  
- **Precision и Recall** — баланс между точностью и полнотой,  
- **ROC AUC** — площадь под ROC-кривой для бинарной классификации.  
Результаты визуализируются с помощью:  
- **ROC-кривой**,  
- **Матрицы ошибок**,  
- **Precision-Recall кривой**.  

---

### Применение модели  
После обучения модель используется для классификации новых изображений через функцию `classify_with_saved_weights()`. Она выполняет:  
1. **Детекцию объектов** с фильтрацией по порогу уверенности (`conf_threshold=0.3`),  
2. **Объединение пересекающихся bounding box'ов** (функция `merge_boxes()`) на основе IoU (порог 0.5),  
3. Визуализацию:  
   - Исходное изображение с bounding box'ами,  
   - Уверенность модели и метки классов,  
   - Подробные данные о размерах объектов.  

---

### Заключение  
Решение демонстрирует высокую эффективность классификации за счет:  
- Использования YOLOv12 для детекции объектов,  
- Аугментаций, повышающих обобщающую способность модели,  
- Фильтрации и объединения bounding box'ов для устранения ложных срабатываний.  
